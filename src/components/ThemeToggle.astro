---
const label = 'ãƒ†ãƒ¼ãƒåˆ‡æ›¿';
---
<button id="theme-toggle" aria-label={label} class="rounded-md border border-gray-300 dark:border-gray-700 px-3 py-1.5 text-sm hover:border-brand select-none">
  <span class="light">ğŸŒ™</span>
  <span class="dark hidden">â˜€ï¸</span>
</button>

<script>
  const btn = document.getElementById('theme-toggle');
  const root = document.documentElement;

  const safeGet = (k) => { try { return localStorage.getItem(k); } catch { return null; } };
  const safeSet = (k, v) => { try { localStorage.setItem(k, v); } catch {} };

  const apply = (theme) => {
    if (theme === 'dark') root.classList.add('dark');
    else root.classList.remove('dark');
  };
  const updateIcon = (theme) => {
    btn?.querySelector('.light')?.classList.toggle('hidden', theme === 'dark');
    btn?.querySelector('.dark')?.classList.toggle('hidden', theme !== 'dark');
  };
  const current = () => (root.classList.contains('dark') ? 'dark' : 'light');
  const next = () => (current() === 'dark' ? 'light' : 'dark');
  const set = (theme) => {
    apply(theme);
    updateIcon(theme);
    safeSet('theme', theme);
  };

  const init = () => {
    const saved = safeGet('theme');
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    const theme = saved ?? (prefersDark ? 'dark' : 'light');
    apply(theme);
    updateIcon(theme);
  };

  btn?.addEventListener('click', () => set(next()));
  init();

  try {
    const mm = window.matchMedia('(prefers-color-scheme: dark)');
    mm.addEventListener?.('change', (e) => {
      if (!safeGet('theme')) set(e.matches ? 'dark' : 'light');
    });
  } catch {}
</script>

