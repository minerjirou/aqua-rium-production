---
import ThemeToggle from '@/components/ThemeToggle.astro';
import Seo from '@/components/Seo.astro';
const title = Astro.props.title ?? import.meta.env.AGENCY_NAME ?? 'Vtuber Site Sample';
const description = Astro.props.description ?? undefined;
const ogImage = Astro.props.ogImage ?? undefined;
const ogType = Astro.props.ogType ?? undefined;
const site = Astro.site?.toString().replace(/\/$/, '') ?? '';
const agency = import.meta.env.AGENCY_NAME ?? 'Vtuber Agency';
---
<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <Seo title={title} description={description} image={ogImage} type={ogType} />
    <link rel="icon" href="/favicon.svg" />
    <link rel="stylesheet" href="/fonts.css" />
    <link rel="stylesheet" href="/global.css" />
    <script>
      try {
        const saved = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        if ((saved ?? (prefersDark ? 'dark' : 'light')) === 'dark') {
          document.documentElement.classList.add('dark');
        }
      } catch {}
    </script>
    <script type="application/ld+json">
      {JSON.stringify({
        '@context': 'https://schema.org',
        '@type': 'Organization',
        name: agency,
        url: site || undefined,
        logo: site ? `${site}/og.png` : '/og.png',
      })}
    </script>
    <script type="application/ld+json">
      {JSON.stringify({
        '@context': 'https://schema.org',
        '@type': 'WebSite',
        name: agency,
        url: site || undefined,
      })}
    </script>
  </head>
  <body class="min-h-screen flex flex-col">
    <header class="border-b border-gray-200 dark:border-gray-800 bg-white/70 dark:bg-gray-950/70 backdrop-blur">
      <div class="mx-auto max-w-6xl px-4 py-3 flex items-center justify-between">
        <a href="/" class="flex items-center gap-2 group">
          <img src="/logo.svg" alt="Aqua-Rium Production logo" class="h-7 w-7" />
          <div class="leading-tight">
            <div class="text-base md:text-lg font-semibold text-gray-900 dark:text-gray-100 group-hover:text-brand-dark transition">{import.meta.env.AGENCY_NAME ?? 'アクアリアムプロダクション'}</div>
            <div class="hidden md:block text-[10px] text-gray-500">Aqua-Rium Production</div>
          </div>
        </a>
        <nav class="hidden md:flex gap-6 items-center text-sm">
          <a href="/members" class="hover:text-brand">メンバー</a>
          <a href="/news" class="hover:text-brand">ニュース</a>
          <a href="https://twitter.com" target="_blank" class="hover:text-brand">X</a>
          <div class="ml-2"><ThemeToggle /></div>
        </nav>
        <button id="btn-mobile-nav" class="md:hidden inline-flex items-center gap-2 rounded border px-3 py-1 text-sm hover:border-brand" aria-controls="mobile-nav" aria-expanded="false" aria-label="メニュー">☰</button>
      </div>
    </header>
    <div id="mobile-nav" class="md:hidden hidden border-b border-gray-200 dark:border-gray-800 bg-white/90 dark:bg-gray-950/90 backdrop-blur">
      <div class="mx-auto max-w-6xl px-4 py-3 flex gap-6 items-center text-sm">
        <a href="/members" class="hover:text-brand">メンバー</a>
        <a href="/news" class="hover:text-brand">ニュース</a>
        <a href="https://twitter.com" target="_blank" class="hover:text-brand">X</a>
        <div class="ml-auto"><ThemeToggle /></div>
      </div>
    </div>
    <main class="flex-1">
      <slot />
    </main>
    <footer class="border-t border-gray-200 dark:border-gray-800 py-8 text-center text-sm text-gray-500">
      © {new Date().getFullYear()} {import.meta.env.AGENCY_NAME ?? 'Agency'}
    </footer>
  </body>
</html>

<style is:global>
  @import '/src/styles/global.css';
</style>
<script>
  try {
    const btn = document.getElementById('btn-mobile-nav');
    const panel = document.getElementById('mobile-nav');
    btn?.addEventListener('click', () => {
      const open = panel?.classList.contains('hidden');
      panel?.classList.toggle('hidden');
      if (btn) btn.setAttribute('aria-expanded', open ? 'true' : 'false');
    });
  } catch {}
</script>

