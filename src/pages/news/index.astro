---
import Base from '@/layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import NewsList from '@/components/NewsList.astro';
import { slugify } from '@/utils/slug';

const news = (await getCollection('news')).sort((a, b) => +new Date(b.data.date) - +new Date(a.data.date));
const tags = Array.from(new Map(news.flatMap(n => (n.data.tags ?? []).map(t => [slugify(t), t])))).map(([slug, name]) => ({ slug, name }));
const categories = Array.from(new Map(news.filter(n => n.data.category).map(n => [slugify(n.data.category as string), n.data.category as string]))).map(([slug, name]) => ({ slug, name }));
---
<Base title={`ニュース | ${import.meta.env.AGENCY_NAME ?? 'Vtuber Agency'}`} description="イベント、リリース、コラボなどの最新情報。">
  <section class="mx-auto max-w-6xl px-4 py-10">
    <h1 class="text-3xl font-bold">事務所ニュース</h1>
    <p class="mt-2 text-gray-600 dark:text-gray-300">イベント、リリース、コラボなどの最新情報。</p>
    {(tags.length > 0 || categories.length > 0) && (
      <div class="mt-6 flex flex-wrap gap-3">
        {categories.map(c => (
          <a href={`/news/category/${c.slug}/page/1`} class="text-xs rounded-full border px-3 py-1 hover:border-brand">カテゴリ: {c.name}</a>
        ))}
        {tags.map(t => (
          <a href={`/news/tag/${t.slug}/page/1`} class="text-xs rounded-full border px-3 py-1 hover:border-brand">#{t.name}</a>
        ))}
      </div>
    )}
    <div class="mt-6">
      <NewsList items={news} />
    </div>
    <div class="mt-6 text-right">
      <a href="/news/page/1" class="inline-block rounded border px-4 py-2 hover:border-brand">すべて見る →</a>
    </div>
  </section>
</Base>
