---
import Base from '@/layouts/BaseLayout.astro';
import NewsList from '@/components/NewsList.astro';
import Pagination from '@/components/Pagination.astro';
import { getCollection } from 'astro:content';

const PAGE_SIZE = 10;

export async function getStaticPaths() {
  const news = (await getCollection('news')).sort((a, b) => +new Date(b.data.date) - +new Date(a.data.date));
  const pageCount = Math.max(1, Math.ceil(news.length / PAGE_SIZE));
  return Array.from({ length: pageCount }).map((_, i) => ({ params: { page: String(i + 1) }, props: { news, page: i + 1, pageCount } }));
}

const { news, page, pageCount } = Astro.props as { news: any[]; page: number; pageCount: number };
const start = (page - 1) * PAGE_SIZE;
const items = news.slice(start, start + PAGE_SIZE);
---
<Base title={`ニュース - ページ${page}`}>
  <section class="mx-auto max-w-6xl px-4 py-10">
    <h1 class="text-3xl font-bold">ニュース</h1>
    <div class="mt-6">
      <NewsList items={items} />
    </div>
    <Pagination page={page} pageCount={pageCount} basePath="/news/page" />
  </section>
</Base>
